<!DOCTYPE html>
<html>
<head>
	<title></title>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>
	<script type="text/javascript">

		myWavDiv = '<div class="myWav"><h3 class="myWav-name"></h3><audio class="myWav-player" controls><source class="myWav-source" src="" type="audio/wav"></audio></div><br>'

		getAllWav()

		$(function() {
    		$('#tts-submit').click(function() {

				text = $('#tts-text').val()
				wavName = $('#tts-name').val()
				ttsType = $('#tts-select').val()

				synthesizeWav(text, wavName, ttsType)
    		})
    	})

    	function setWavList(wavsObject) {
    		console.log(wavsObject)

    		for (const [key, value] of Object.entries(wavsObject)) {
    			$('#wav-list').append(myWavDiv)

    			$($('.myWav-name')[$('.myWav-name').length - 1]).text(key)
    			$($('.myWav-source')[$('.myWav-name').length - 1]).attr('src', value)
    			$($('.myWav-player')[$('.myWav-name').length - 1])[0].load()
    		}
    	}

    	function synthesizeWav(text, wavName, ttsType) {
    		$('#mywav').hide()
    		failMessage(false, '')
    		
			myData = {
				'guid': sessionStorage['guid'],
				'wav_name': wavName,
				'text': text,
				'tts_type': Number(ttsType)
			}

	        $.ajax({
	            type: 'POST',
	            url: '/api/voice/tts',
	            data: JSON.stringify(myData),
	            contentType: "application/json",
	            dataType: 'json',

	            success: function(res) {
            		$('#tts-wav-source').attr('src', res['data']['wav'])
            		$('#tts-wav-player')[0].load()
            		$('#tts-wav-name').text(wavName)
            		$('#tts-wav').show()
	            },

	            error: function(xhr, status, error) {
            		failMessage(true, xhr.responseJSON['message'])
	            }
	        })
    	}

    	function getAllWav() {
    		myData = {
				'guid': sessionStorage['guid']
			}


	        $.ajax({
	            type: 'POST',
	            url: '/api/voice/getAllWav',
	            data: JSON.stringify(myData),
	            contentType: "application/json",
	            dataType: 'json',

	            success: function(res) {
	            	setWavList(res['data']['wavs'])
	            },

	            error: function(xhr, status, error) {
            		console.log(xhr.responseJSON['message'])
	            }
	        })
    	}

    	function deleteAllWav() {
    		myData = {
				'guid': sessionStorage['guid']
			}


	        $.ajax({
	            type: 'POST',
	            url: '/api/voice/deleteAllWav',
	            data: JSON.stringify(myData),
	            contentType: "application/json",
	            dataType: 'json',

	            success: function(res) {
	            	return res['status']
	            }
	        })
    	}

    	function loadMessage(tell) {
    		if (tell) {
    			$('#load-message').show()
    		} else {
    			$('#load-message').hide()
    		}
    	}

    	function failMessage(tell, message) {
    		if (tell) {
    			$('#fail-message').show()
    		} else {
    			$('#fail-message').hide()
    		}

    		$('#fail-message').html(message)
    	}
	</script>
</head>
<body>
	<h1>My Wav List</h1>
	<div id="wav-list">
	</div>

	<h1>Speech Synthesis</h1>
	<div>
		<p>name</p><input id='tts-name' name="name" type="text" /><br>
		<p>text</p><input id='tts-text' name="text" type="text" /><br>
		<select id="tts-select">
			<option value=0>Mandarin(BZNSYP)</option>
			<option value=1>English(LJSpeech)</option>
		</select><br>
		<input id='tts-submit' type="submit" value="submit" />
	</div>

	

	<div id="tts-wav" style="display: none">
		<br>
		<h3 id="tts-wav-name">my synthsis wav</h3>
		<audio id="tts-wav-player" controls>
			<source id="tts-wav-source" src="" type="audio/wav">
		</audio>
		
	</div>

	<br>
	<div id="load-message" style="display:none; background-color: blue; color: white">Loading</div>
	<br>
	<div id="fail-message" style="display:none; background-color: red; color: white"></div>
</body>
</html>
	
